# 認証フロー仕様書（オンボーディング後）

## 0. 位置づけ

本フローは、オンボーディング（画面1〜5）完了後に表示される
**認証案内および認証画面群**である。

- 強制認証は行わない
- スキップ（後回し）可能
- 目的は「管理」ではなく **継続・引き継ぎ・保護**

オンボーディングで形成された
「安心・余韻・静かなワクワク」を壊さないことを最優先とする。

---

## 1. フロー全体構成

```text
オンボーディング完了
  ↓
A1. アカウント案内（選択）
  ├─ A2. サインアップ
  │    └─ A4. メール認証
  │         └─ A5. 認証完了
  ├─ A3. ログイン
  │    └─ A5. 認証完了
  └─ スキップ（ゲスト）→ ホーム
```

---

## 2. A1：アカウント案内（選択画面）

### 目的
- 「今すぐ決めなくていい」を保証する
- 認証の**意味だけ**を静かに伝える

### 表示内容（例）

**タイトル**
```
このままでも使えます
```

**説明**
```
記録を引き継いだり
別の端末でも使うには
アカウントが必要になります
```

**メリット（箇条書き）**
- 端末を変えても続きから使える
- データを失いにくくなる
- 公開風船に参加できる（任意）

### ボタン
- Primary: アカウントを作る
- Secondary: ログインする
- Tertiary: あとで（いまはこのまま）

### 補足
- 「なぜアカウントが必要？」リンクを任意で配置
- ランキング・評価・義務的表現は禁止

---

## 3. A2：サインアップ（メール）

### 目的
- 最小入力でアカウントを作成する

### 入力項目
- メールアドレス（必須）
- パスワード（必須）
  - 8文字以上

### 表示文言（例）

**タイトル**
```
アカウントを作る
```

**サブ**
```
引き継ぎのために使います
```

### ボタン
- Primary: 次へ
- Secondary: ログインに切り替える
- Back: 戻る

### 遷移
- 次へ → A4（メール認証）

---

## 4. A3：ログイン

### 入力項目
- メールアドレス
- パスワード

### ボタン
- Primary: ログイン
- Secondary: アカウントを作る
- テキスト: パスワードを忘れた

### 遷移
- 成功 → A5（認証完了）またはホーム
- 失敗 → エラーメッセージ表示

---

## 5. A4：メール認証（確認コード方式）

### 方式
- 確認コード（6桁）を推奨

### 表示内容

**タイトル**
```
確認コードを入力
```

**説明**
```
メールに送ったコードを
入力してください
```

### 入力
- 確認コード（6桁）

### ボタン
- Primary: 確認する
- テキスト: コードを再送する
- テキスト: メールアドレスを変更

### 遷移
- 成功 → A5（認証完了）
- 失敗 → エラー表示

---

## 6. A5：認証完了

### 目的
- オンボーディングの余韻を保ったまま合流させる

### 表示文言（例）

**タイトル**
```
準備ができました
```

**サブ**
```
今日の一歩は
そのまま引き継がれます
```

### ボタン
- Primary: 続ける（ホームへ）

---

## 7. ゲスト運用

### ゲスト継続
- A1で「あとで」を選択した場合、ゲストとして利用継続

### 認証を提案するタイミング（例）
- 端末変更・バックアップ時
- 公開風船への参加・作成時
- セッション切れ時

---

## 8. ゲスト → 認証 データ移行

### 移行対象
- 作成タスク
- 選択中の風船状態
- 達成履歴（内部保持）

### 原則
- ユーザー操作を増やさない
- 認証成功時に自動統合

---

## 9. エラーメッセージ方針

- 叱らない
- 急かさない
- 短く伝える

### 例
- メール形式: メールアドレスを確認してください
- パスワード: 入力が合っていないようです
- コード期限: コードの期限が切れました。再送できます
- 通信: 通信が不安定です。もう一度試してください

---

## 10. 実装用 状態管理（例）

- hasCompletedOnboarding: boolean
- authState: guest | authenticated
- onboardingVersion: number
- pendingEmail: string?
- guestId / deviceId
- migrationStatus: none | pending | done | failed

---

## 11. UI / 導線ルール

- A1では必ず「あとで」を用意
- 説明より操作を優先
- 認証完了後に煽り文言を出さない

---

## 12. まとめ

- 認証は義務ではなく「続けるための手続き」
- オンボーディングの余韻を壊さない
- 必要になったときに、自然に差し出す
